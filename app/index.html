<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Elektronische Lauflog</title>
  <link rel="stylesheet" href="resources/css/dropzone.css">

  <link rel="stylesheet" href="resources/css/style.css">

  <link rel='stylesheet' href='fullcalendar/packages/core/main.css' />
  <link rel='stylesheet' href='fullcalendar/packages/daygrid/main.css' />
  <link rel='stylesheet' href='fullcalendar/packages/timegrid/main.css' />
  <link rel='stylesheet' href='fullcalendar/packages/list/main.css' />
  <script src='fullcalendar/packages/core/main.js'></script>
  <script src='fullcalendar/packages/daygrid/main.js'></script>
  <script src='fullcalendar/packages/timegrid/main.js'></script>
  <script src='fullcalendar/packages/list/main.js'></script>

  <script src="resources/js/map/leaflet.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-gpx/1.4.0/gpx.min.js"></script>

  <!-- <link rel="stylesheet" href="/resources/css/leaflet.css" />
  <script src="resources/js/map/leaflet.js"></script> -->

  <script>
  var name;
  var start_time;
  var end_time;
    new L.GPX('uploads/2020-05-04_179610056_GPX Download_ Kelheim – Altmühltor Runde von Regensburg-Prüfening.gpx', {
      async: true,
    }).on('loaded', function(e) {
      var gpx = e.target;
      name = gpx.get_name();
      start_time = gpx.get_start_time();  //'2020-05-26';
      end_time = gpx.get_end_time();
    });

    document.addEventListener('DOMContentLoaded', function() {
      var calendarEl = document.getElementById('calendar');

      var calendar = new FullCalendar.Calendar(calendarEl, {
        plugins: ['dayGrid', 'timeGrid', 'list'],
        header: {center: 'addEventButton'},
        eventClick: function(info) {
          var eventObj = info.event;

          if (calendar.getEventById('1')) {
            alert(
              'Clicked ' + eventObj.title + '.\n' +
              'Will show ' + eventObj.url
            );

            //window.open(eventObj.url);

            //info.jsEvent.preventDefault(); // prevents browser from following link in current tab.
          } else {
            alert('Clicked ' + eventObj.title);
          }
        },
        customButtons: {
          addEventButton: {
            text: 'add event...',
            click: function() {
              var dateStrStart = start_time;
              var dateStrEnd = end_time;
              var dateStart = new Date(dateStrStart); // will be in local time
              var dateEnd = new Date(dateStrEnd);
              if (!isNaN(dateStart.valueOf())) { // valid?
                calendar.addEvent({
                  id: 1,
                  title: name,
                  start: dateStart,
                  end: dateEnd,
                  url: 'map.html',
                  allDay: false
                });
                alert('Great. Now, update your database...');
              } else {
                alert('Invalid date.');
              }
          }
        }
      },
        events: [
          {
            title: name,
            start: '2020-04-26T10:04:10Z',
            //end: '2020-04-26T12:04:10Z',
          }
        ]

      });
      calendar.setOption('height', 700, 'contentHeight', 700, 'aspectRatio', 1.5,);
      calendar.render();
    });
  </script>
</head>

<body>
  <div id="content">
    <h1>Elektronische Lauflog</h1>
    <div class="topnav">
      <a class="active" href="#">Home</a>
      <a href="map.html">Karte</a>
      <a href="tracks.html">Tracks</a>
    </div>


    <form action="/file-upload" class="dropzone" id="my-awesome-dropzone"></form>

    <div id="calendar"></div>
    <script src="resources/js/datenverwaltung/dropzone.js"></script>
    <script type="module" src="resources/js/index.js"></script>
    <!-- <script src="resources/js/calendar/calendar.js"></script> -->
  </div>
</body>

</html>
